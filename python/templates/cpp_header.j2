#pragma once
// Generated by StateSurf minimal generator (v1 subset). C++11 header-only.
namespace statesurf {

enum class State {
{% for state in states %}
  {{ state }}{{ "," if not loop.last else "" }}
{% endfor %}
};

enum class Event {
{% for event in events %}
  {{ event }}{{ "," if not loop.last else "" }}
{% endfor %}
};

enum class GuardId {
{% for guard in guard_ids %}
  {{ guard }}{{ "," if not loop.last else "" }}
{% endfor %}
};

enum class ActionId {
{% for action in action_ids %}
  {{ action }}{{ "," if not loop.last else "" }}
{% endfor %}
};

struct IHooks {
  virtual ~IHooks() {}
  virtual void on_entry(State) = 0;
  virtual void on_exit(State) = 0;
  virtual bool guard(State, Event, GuardId) = 0;
  virtual void action(State, Event, ActionId) = 0;
};

inline void on_event(State, Event) {}
inline void on_transition(State, State, Event) {}

class {{ machine_name }} {
public:
  explicit {{ machine_name }}(IHooks& impl) : impl_(impl) { reset(); }

  void reset() {
    terminated_ = false;
{% if reset_lines %}
{% for line in reset_lines %}
    {{ line }}
{% endfor %}
{% else %}
    (void)0;
{% endif %}
  }

  State state() const { return s_; }
  bool terminated() const { return terminated_; }

  void dispatch(Event e) {
    if (terminated_) return;
    on_event(s_, e);
    switch (s_) {
{% for state in state_cases %}
      case State::{{ state.name }}: {
{% if state.events %}
        switch (e) {
{% for event in state.events %}
          case Event::{{ event.name }}: {
{% for line in event.lines %}
{{ line }}
{% endfor %}
          }
{% endfor %}
          default: return;
        }
{% else %}
        return;
{% endif %}
      }
{% endfor %}
    }
  }

private:
  IHooks& impl_;
  State s_;
  bool terminated_ = false;
};

} // namespace statesurf
